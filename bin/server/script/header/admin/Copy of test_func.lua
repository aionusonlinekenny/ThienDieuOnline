Include( "\\script\\header\\taskid.lua" );
Include( "\\script\\header\\testgame.lua" );
Include( "\\script\\header\\admin\\test_limited.lua" );
Include("\\script\\lib\\worldlibrary.lua");
Include("\\script\\header\\npcfile.lua");
Include("\\script\\global\\droprate\\SourceDrop.lua");
Include("\\script\\event\\demhuyhoang\\event.lua")
Include("\\script\\header\\bosstieuhk.lua");
function test_func()

-- xanhtest()
	-- SetRevPos(29);--xy
-- SetRankEx("Kiem Tra Color","250, 0, 240")
-- for i = 4863,4872 do
-- AddItemID(AddItem(2,0,i,0,0,5,0))
-- end
-- local kiemtra = SetExtPoint(500)
-- Msg2Player(""..GetCurCamp().."")
-- OpenTong(0)
-- AddItemID(AddItem(0,6,399,0,0,0,0,0))
-- AddItemID(AddItem(0,6,399,0,0,1,0,0))
-- AddItemID(AddItem(0,6,399,0,0,2,0,0))
-- AddItemID(AddItem(0,6,399,0,0,3,0,0))
-- AddItemID(AddItem(0,4,489,0,0,4,0,0))
-- AddItemID(AddItem(0,4,343,0,0,4,0,0))
-- AddItemID(AddItem(0,6,1063,0,0,0,0,0))--chat room
-- AddMagic(210,1);
	--local nNewItem = AddItemID(AddItem(0,4,417,0,0,5,0,0)) --tien dong nSel cai
	--local nNewItem1 = AddItemID(AddItem(0,4,417,0,0,5,0,0)) --tien dong nSel cai
		-- local  nNewItem = {};
		-- for i = 1,3 do
		-- nNewItem[i] = AddItemID(AddItem(0,4,417,0,0,5,0,0)) --tien dong nSel cai
		-- SetStackItem(nNewItem[i],100);
		-- end
		 
		 -- sonhap = 1900
		 -- somoi = (floor(sonhap/100))*100
		-- for i = 1,99 do
			-- if somoi + i == sonhap then
			-- Msg2Player(" so khong hop le")
			-- return end
		-- end
	-- AddItemID(AddItem(0,7,0,1,10,0,0,0))
	-- AddItemID(AddItem(0,4,343,0,0,5,0,0))
		
	-- AddProp(5000)
		-- NewWorld(489,1560,3216) --di chuyen vao vuot ai
		-- SetFightState(1)
	-- for i = 97,101 do
	-- AddItemID(AddItem(3,0,i,0,0,10,0))
	-- end
	-- for i = 3434,3443 do
	-- AddItemID(AddItem(2,0,i,0,0,10,0))
	-- end
NewWorld(197,1600,3200)
-- SetFightState(0)
-- Msg2Player("Lucky:"..GetLucky(0).."")
-- Msg2Player("Task:"..GetTask(211).."")
-- local nIndex = {};
-- for i = 1,3 do
-- nIndex[i]=AddItemID(AddItem(0,6, 2126,0,0,0,0,0))
-- AddTimeItem(LockItem(nIndex[i]),30*24*60*60)

-- end
-- AddItemID(AddItem(2,0,176,0,0,5,0,random(5,10)));
-- AddItemID(AddItem(0,4,343,0,0,0,0,0)) --Kim Nguyen Bao
-- AddItemID(AddItem(0,4,343,0,0,0,0,0))
-- AddItemID(AddItem(0,4,343,0,0,0,0,0))

-- SetLockState(0);
-- if GetLockState() > 0 then -- kiem tra co khoa pass ruong hay khong?
	-- Msg2Player("12");
	-- else
	-- Msg2Player("2456");
-- end
-- AddItemID(AddItem(0,4,343,0,0,0,0,0))
-- AddItemID(AddItem(0,4,343,0,0,0,0,0))
-- AddItemID(AddItem(0,4,343,0,0,0,0,0))
-- AddItemID(AddItem(0,4,343,0,0,0,0,0))
-- AddItemID(AddItem(0,4,343,0,0,0,0,0))
-- AddItemID(AddItem(0,4,343,0,0,0,0,0))
-- AddItemID(AddItem(0,0,11,207,0,0,0,0))
-- AddSkillState(729, 1, 1, 60*60*18, 1); -- ho tro tan thu
-- AddMagic(729,20)
-- local nW,nX,nY = GetWorldPos()
-- nX = nX *32
-- nY = nY *32
-- Msg2Player(""..nX.." "..nY.." ")
	-- tab_monster = {
	-- {53024,104288,0},
	-- {53152,104160,1},
	-- {53280,104064,2},
	-- {53440,103936,3},
	-- {53600,103776,4}
	-- }
	-- for i = 1,getn(tab_monster) do
	-- nNpcIdx = AddNpcNew(603,1,53,tab_monster[i][1],tab_monster[i][2],DEATH_COCGO,
		-- 5,nil,1,tab_monster[i][3],300000,21000000,5000,8000,5000,6000,nil,nil,nil,80,3,"");
	-- SetNpcValue(nNpcIdx,3);
	-- end
	-- AddOwnExp(5000000)
	
-- for i = 1,10 do
	 -- cal(NpcIndex)
-- end


-- Msg2Player(" "..GetLucky(0).." ");
	-- Msg2Player("KIERM TRA");
	-- local type1= random(1,10);
	-- local type2= random(1,10);
	-- local type3= random(1,10);	
	-- for i = 1,1000 do
		-- if (type1 ~= type2) and (type2 ~= type3) then
		-- Msg2Player(" "..type1.." - "..type2.." - "..type3.."");
		-- return;
		-- end
	-- end
	-- Msg2Player(" "..type1.." - "..type2.." - "..type3.."");
	-- nIndex = AddItem(0,0, 0,5,10,0,0)
	-- AddItemID(nIndex)
	
	-- for i = 1,10 do
	 -- drop(NpcIndex)
	-- end
-- AddItemID(AddItem(2,0,190,0,0,0,5)); -- nhu tinh
-- AddItemID(AddItem(2,0,194,0,0,0,5)); -- duong nghe giap hoang kim

		-- AddItemID(AddItem(2,0,162,0,0,0,7));

		-- AddItemID(AddItem(2,0,161,0,0,0,7));
	
		-- AddItemID(AddItem(2,0,167,0,0,0,3));

		-- AddItemID(AddItem(2,0,166,0,0,0,3));

		-- AddItemID(AddItem(2,0,168,0,0,0,3));
	
		-- AddItemID(AddItem(2,0,165,0,0,0,3));
		-- AddItemID(AddItem(0,0,10,6,10,0,0,0))
		-- AddItemID(AddItem(0,6,1126,0,0,5,0));
		-- GetKeyPc(GetAccount());
		-- Say("Test Limitted",2,"Di ve ba lang huyen/move","Roi khoi ba lang huyen/move","Thoat/no")
		-- OpenTong(1);
-- HUYHOANG_TRUNG={
-- [1] = "H¹t Huy Hoµng trung",
-- [2] = {
	-- {322,54493,113656},
	-- {322,54558,114484},
	-- {322,54812,113986},
	-- {322,55036,114376},
	-- {322,55124,113610},
	-- {322,55381,113936},
	-- {322,55772,113664},
	-- {322,55984,114264},
	-- {322,56159,113692},
	-- {322,56398,113358}
	-- }
-- };
		-- for i = 1,getn(HUYHOANG_TRUNG[2]) do
			-- Msg2Player(" "..HUYHOANG_TRUNG[2][i][1].."");
		-- end
-- HUYHOANG_CAO={
-- [1] = "H¹t Huy Hoµng cao",
-- [2] = {
	-- {322,54493,113656},
	-- {322,54558,114484},
	-- {322,54812,113986},
	-- {322,55036,114376},
	-- {322,55124,113610},
	-- {322,55381,113936},
	-- {322,55772,113664},
	-- {322,55984,114264},
	-- {322,56159,113692},
	-- {322,56398,113358},
	-- {322,1702,3551*32},
	-- {322,1706*32,3566*32},
	-- {322,1701*32,3562*32},
	-- {322,1709*32,3542*32},
	-- {322,1716*32,3548*32},
	-- {322,1720*32,3559*32},
	-- {322,1712*32,3573*32},
	-- {322,1707*32,3583*32},
	-- {322,1700*32,3577*32},
	-- {322,1708*32,3553*32},
	-- {322,1714*32,3540*32},
	-- {322,1705*32,3535*32},
	-- {322,1697*32,3538*32},
	-- {322,1726*32,3541*32},
	-- {322,1735*32,3547*32},
	-- {322,1750*32,3556*32},
	-- {322,1744*32,3571*32},
	-- {322,1759*32,3570*32},
	-- {322,1765*32,3549*32},
	-- {322,1766*32,3530*32}
	-- }
-- };
-- QUAHH_FILE = "\\script\\event\\demhuyhoang\\quahuyhoang.lua"
		-- for i=1,getn(HUYHOANG_CAO[2]) do
		-- nNewNpcIdx = AddNpcNew(1111,1,HUYHOANG_CAO[2][i][1],HUYHOANG_CAO[2][i][2],HUYHOANG_CAO[2][i][3],QUAHH_FILE,6)
		-- SetNpcParam(nNewNpcIdx,1,3);
		-- SetNpcTimeout(nNewNpcIdx,5400);
		-- end
		-- SetTask(TASK_RESET,0);
		-- addhhh()
		-- a= random(0,0);
		-- Msg2Player(""..a.."");
		-- AddItemID(AddItem(0,0,9,1,2,1,0,0,0))
			-- nGenre=7;
	-- nDetail=9;
	-- nParti=1;
	-- nLevel=2;
	-- nSeries=2;
	-- nLuck=0;
	-- local nValue = GetTask(TASK_NVST);
-- SetTask(TASK_NVST, SetNumber(2,nValue,1,2));
-- releasebosstieu()
-- local nSubWorldId;
			-- Msg2MSAll(1,"ThuyÒn sÏ rêi bÕn trong "..(10-1).." phót n÷a!");
			-- AddItemID(AddItem(0,6,3361,0,0,5,0,0))
-- local nHorse = random(1,30);
		-- local nIndex = AddItemID(AddItem(0,6,random(2337,2341),0,0,5,0,0)) --Ma bai
		-- if nHorse == 4 then
			-- AddItemID(AddItem(0,6,random(2337,2341),0,0,5,0,0)) --Ma bai
			-- Msg2SubWorld("§¹i hiÖp <color=yellow>"..GetName().."<color> võa nhËn ®­îc <color=yellow>M· bµi vÜnh viÔn<color> tõ b¶o r­¬ng v­ît ¶i!");
		-- else
			-- AddTimeItem(nIndex,15*24*60*60) -- 15 ngay;
			-- Msg2SubWorld("§¹i hiÖp <color=yellow>"..GetName().."<color> võa nhËn ®­îc <color=yellow>M· bµi<color> tõ b¶o r­¬ng v­ît ¶i!");
		-- end
		-- NewWorld(53,1600,3200);
		-- SetFightState(0);
		-- AddItemID(AddItem(0,6,1436,0,0,5,0));
		-- AddItemID(AddItem(0,6,122,0,0,5,0));
		-- AddItemID(AddItem(0,6,123,0,0,5,0));
		-- AddItemID(AddItem(0,6,399,0,0,2,0));
		-- AddItemID(AddItem(0,6,399,0,0,3,0));
		-- AddItemID(AddItem(0,6,399,0,0,4,0));
		-- nTotalTask = GetTask(TASK_RESET);
		-- SetTask(TASK_RESET,0)
		-- nTaskValue = GetNumber(1,nTotalTask,3);--so lan
		
		-- local nPlayerDataIdx = PIdx2MSDIdx(1,PlayerIndex);
		-- nOnline = GetPMParam(1,nPlayerDataIdx,0);
		-- Msg2Player(""..nPlayerDataIdx.."");
		-- SetPMParam(1,nPlayerDataIdx,0,0);
		-- Msg2Player(""..nOnline.."");
		-- VUOTAI_FILE_BOSS="\\script\\feature\\vuotai\\die_boss.lua"
		-- nNpcIdx = AddNpcNew(1038,100,
		-- 53,1672*32,3255*32,nil,nil,"§éc C« Quû KiÕm",nil,
		-- RANDOMC(0,1,2,3,4),0,1,nil,5000,200,nil,10,20,nil,50,2,nil);
		-- if(nNpcIdx > 0) then
		-- AddMSNpc(1,nNpcIdx);
		-- SetNpcScript(nNpcIdx, VUOTAI_FILE_BOSS);
		-- end
		-- CloseMission(1)
		-- Input("asd");
		-- infoPlayer()
		-- for j = 1,10 do
			-- for i = 1,10 do
				-- if i == j then
				 -- Msg2Player("dep trai "..i.."")
				-- end
			-- end
		-- end
		-- Msg2Player(" "..GetUUID().." ");
		-- local nFind = FindNamePlayer(GetName());
		-- Msg2Player(" "..nFind.." ")
		-- Input("Nhapso",9999);
		-- local nItem = AddItemID(AddItem(0,4,417,0,0,5,0,0));
		
			-- for i = 1,9 do
					-- local nIndex ={}
					-- nIndex[i]= AddItemID(AddItem(0,4,417,0,0,5,0,0));
					-- SetStackItem(nIndex[i],100);
			-- end
		-- IncSkillExp(321,)
			-- AddSkillState(1555, 1, 1, 8*60*60*18, 1);
		-- AddMagicScript(4814);
		-- AddMagicScript(4815);
		-- AddMagicScript(4816);
		-- AddItemID(AddItem(0,0,10,RANDOMC(6,8),1,5,0));
		-- Msg2Player(" "..GetKeyPc().." ")
end

function Nhapso()
	local nNum = tonumber(GetInput());
	local nNum2 = nNum;
	local nNum3 = 0;
	local nIndex  ={};
	


	if (GetExtPoint() < nNum) or  (nNum == 0) then
		Talk(1,"","Ta ®· qu¸ bËn rén víi c«ng viÖc, cí sao nhµ ng­êi l¹i ®ïa giìn!");
		return
	end

	if CheckRoom(6,5) ==0 then
		Say("Xin h·y s¾p xÕp l¹i hµnh trang! Nhí ®Ó trèng 6x5 « trë lªn nhÐ!", 1, "§­îc råi./no");
		return
	end	
	
	if (nNum > 3000) then
		Say("Mçi lÇn chØ ®­îc rót 3000 ®ång th«i!", 1, "§­îc råi./no");
		return
	end
	PayExtPoint(nNum);
		
		if (nNum >= 100 and nNum < 1000) then	 -- tren 100 dong
			nNum = floor(nNum/100);
			for i = 1,nNum do
					nIndex[i] = AddItemID(AddItem(0,4,417,0,0,5,0,0));
					SetStackItem(nIndex[i],100);
			end
			nNum = nNum * 100;
			if (nNum2-nNum > 10 and nNum2-nNum < 100) then
					nNum3 = nNum2-nNum;
					local nIndexX = AddItemID(AddItem(0,4,417,0,0,5,0,0));
					SetStackItem(nIndexX,nNum3);			
			elseif (nNum2-nNum > 0 and nNum2-nNum < 10) then
				nNum3 = nNum2-nNum;
				local nIndexS = AddItemID(AddItem(0,4,417,0,0,5,0,0));
					SetStackItem(nIndexS,nNum3);

			end	
			
		elseif nNum < 100 then ---Duoi 100 dong
				local nIndexZ = AddItemID(AddItem(0,4,417,0,0,5,0,0));
					SetStackItem(nIndexZ,nNum);
		elseif (nNum >= 1000) and (nNum <= 3000) then 
			nNum = floor(nNum/1000);
			for i = 1,(nNum*10) do
				local nIndexF = {}; 
					nIndexF = AddItemID(AddItem(0,4,417,0,0,5,0,0));
					SetStackItem(nIndexF,100);
			end
			
			nNum = nNum * 1000;
			if  (nNum2 - nNum > 10) and (nNum2 - nNum > 100) then
				nNum3 = floor((nNum2-nNum)/100);
				for i = 1,nNum3 do
					local nIndexX = AddItemID(AddItem(0,4,417,0,0,5,0,0));
					SetStackItem(nIndexX,100);
				end
				nNum3 = nNum3 * 100;
				nNum4 = (nNum2 - nNum) - nNum3;
				local nIndexK = AddItemID(AddItem(0,4,417,0,0,5,0,0));
				SetStackItem(nIndexK,nNum4);
			elseif (nNum2-nNum > 0 and nNum2-nNum < 10) then
				nNum4 = (nNum2 - nNum);
				local nIndexL = AddItemID(AddItem(0,4,417,0,0,5,0,0));
				SetStackItem(nIndexL,nNum4);
			end
		end
end;

function infoPlayer()
		-- local nRow = nSel+1;

	local TAB_TT =
	{
	{1	,50 },
	{51 ,100},
	{101,150},
	{151,200},
	{201,250},	
	{251,300},	
	{301,350},	
	{351,400},	
	{401,450},
	{451,500},		
	};
	for i = TAB_TT[1][1],TAB_TT[1][2] do
		local nName = GetName(i);
		local nW,nX,nY = GetWorldPos(i);
		local TK = GetAccount(i);
		if TK == "2" then
			local nPlayer = FindPlayer(nName);
			local tempid = PlayerIndex;
			PlayerIndex = nPlayer;
			local nW,nX,nY = GetWorldPos();
			PlayerIndex = tempid;
			-- OfflineLive();
			Msg2Player(""..i.."#"..nName.."#"..nW.."#("..floor(nX/8).."/"..floor(nY/16)..")#"..TK..".");
		
		end
	end
end

function asd()
	local nString = GetInput()
	Msg2Player(""..nString.."")
end


function move(nSel)
local nSel = nSel + 1;
local nNamePlayer = GetName();
local nKey = GetKeyPc();
	if nSel == 1 then
		for i = 1,getn(TestLimited) do -- check dieu kien
			if GetKeyPc() == TestLimited[i][1] then
			Msg2Player("§¹i hiÖp cã nh©n vËt : <color=orange> "..GetName().." <color> ®· vµo bªn trong b¶n ®å chiÕn ®©u råi!");
			return
			end					
		end
		Msg2Player("Chµo mõng ®¹i hiÖp gia nhËp phe <color=orange> Tèng <color> h·y cè g¾ng lªn Top!");
		nNamePlayer	= nNamePlayer;
		nKey	= nKey;
		SAVEDULIEU(i,nKey,nNamePlayer);
		NewWorld(53,1600,3200);
	else
		for i = 1,getn(TestLimited) do -- check dieu kien
			if GetKeyPc() == TestLimited[i][1] and GetName() == TestLimited[i][2] then
				nNamePlayer	= "";
				nKey	= "";
				SAVEDULIEU(i,nKey,nNamePlayer);
				NewWorld(2,2609,3590);	
			return
			end					
		end
		Msg2Player("Khong co du lieu cua nhan vat");
	end
end

function SAVEDULIEU(i,nKey,nNamePlayer)
	if nKey == "" and nNamePlayer == "" then
		TestLimited[i] = {nKey,nNamePlayer};
		local nNAME_Change = TaoBang(TestLimited,"TestLimited");
		SaveData("script/header/admin/test_limited.lua",nNAME_Change);
	else
		TestLimited[getn(TestLimited)+1] = {nKey,nNamePlayer};
		local nNAME = TaoBang(TestLimited,"TestLimited");
		SaveData("script/header/admin/test_limited.lua",nNAME);
	end
end

function DELDULIEU()
	TestLimited= {{"KEY_COMPUTER","NAME_PlAYER"}};
	local nNAME = TaoBang(TestLimited,"TestLimited");
	SaveData("script/header/admin/test_limited.lua",nNAME);
end
function no()
end
-- function drop(NpcIndex)
-- local nIndex = 0;
-- nIndex = AddItem(0,0,2,0,1,0,0);
			-- type1 , value1_1, value1_3,
			-- type2 , value2_1, value2_3,
			-- type3 , value3_1, value3_3,
			-- type4 , value4_1, value4_3,
			-- type5 , value5_1, value5_3,
			-- type6 , value6_1, value6_3,
			-- type7 , value7_1, value7_3,
			-- type8 , value8_1, value8_3
			-- =
			-- 166 , 200, 0,
			-- 0 , 0, 0,
			-- 0 , 0, 0,
			-- 0 , 0, 0,
			-- 0 , 0, 0,
			-- 0 , 0, 0,
			-- 0 , 0, 0,
			-- 0 , 0, 0;
-- SetMagicAttrib(nIndex,
			-- type1 , value1_1, value1_3,
			-- type2 , value2_1, value2_3,
			-- type3 , value3_1, value3_3,
			-- type4 , value4_1, value4_3,
			-- type5 , value5_1, value5_3,
			-- type6 , value6_1, value6_3,
			-- type7 , value7_1, value7_3,
			-- type8 , value8_1, value8_3
					-- );							
-- DropItem(nIndex);
-- end